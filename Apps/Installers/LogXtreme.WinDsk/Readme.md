# LogXtreme for Windows WiX Installer

## Generation of the components

The WiX Toolset tool **heat.exe** is employed to generate the fragment **DistFilesFragment.wsx** which contains 
the list of all components necessary for the install of **LogXtrme for Windows**. Each components install a 
sinlge file and which is also set to be the **KeyPath** for the component in line with the Windows Installer best 
practices.

In order to generarate **DistFilesFragment.wsx** open a **Visual Studio Developer Console** in the **dist** folder
of the WiX project. The **dist** folder is an exact copy in folder structure and contents of **LogXtreme for Windows**
as it is espected to be on the target system after successful installation.

---

### The WiX Toolset heat.exe

```> heat --help```

---

### Run the following command

```heat.exe dir "." -cg DistFilesComponentGroup -ag -scom -sreg -sfrag -dr DIR_LOGXTREME_WIN_DSK -var var.SourceDir -t "..\RemoveDistFolderElementTransform.xslt" -out "..\DistFilesFragment.wxs"```

---

### Component GUID

The safest option is to let WiX generate the GUIDs for each component. As long as 
the rule to have a single File maked as KeyPath of the corresponding component the 
GUID will be the same as the algorithm that determines the component GUID only uses
the KeyPath. This results always in the same GUID for the same component as long as 
the installation path and teh name of the file remain the same.

1. [Is it safe to use autogenerated GUID on Component tags
](https://stackoverflow.com/questions/16120473/is-it-safe-to-use-autogenerated-guid-on-component-tags)

2. [How to generate consistent GUID using wix harvest tool
](https://stackoverflow.com/questions/20748544/how-to-generate-consistent-guid-using-wix-harvest-tool)

3. [Change my component GUID in wix?
](https://stackoverflow.com/questions/1405100/change-my-component-guid-in-wix/1422121)


---

### How to use an XSLT transformation on the XML output of heat.exe

1. [Removing a parent element in xml while keeping it's children using xslt
](https://stackoverflow.com/questions/36190910/removing-a-parent-element-in-xml-while-keeping-its-children-using-xslt)

2. [WiX Installer: using xslt with heat.exe to update attributes
](https://stackoverflow.com/questions/8034798/wix-installer-using-xslt-with-heat-exe-to-update-attributes)

---

### Breakdown of the command
```
heat.exe dir "." 
		 -cg DistFilesComponentGroup 
		 -ag 
		 -scom 
		 -sreg 
		 -sfrag 		  
		 -dr DIR_LOGXTREME_WIN_DSK 
		 -var var.SourceDir
		 -t "..\RemoveDistFolderElementTransform.xslt" 
		 -out "..\DistFilesFragment.wxs"
```

- dir "."
  
  This is the folder with the distributable assets i.e. ```C:\GitHub\Loggers\Apps\Installers\LogXtreme.WinDsk\dist```.
  Run **heat** in this folder from the **Visual Studio Development Console**.
  
- ag

  Auto generate the components GUIDs. This causes the **Guid="*"** for each **\<Component>** as discussed.

- scom

  Suppresses COM elements.

- sreg

  Suppresses registry harvesting

- sfrag

  Suppresses fragments

- dr DIR_LOGXTREME_WIN_DSK

  Provides the Id for the DirectoryRef elements i.e. **\<DirectoryRef Id="DIR_LOGXTREME_WIN_DSK">**.
  This is the reference to the target directory of the installation and it must have been declared
  in **Product.wxs**.

- var var.SourceDir

  Causes the File elements to use a preprocessor variable as prefix on their Source attribute value.
  For example **Source="$(var.SourceDir)\LogXtreme.Extensions.dll"**. The **$(var.SourceDir)** is 
  evaluated at run time by WiX when the **Config.wxi** is imported into **Product.wxs** by processing 
  the tag **\<?include "Config.wxi"?>**

- out "..\DistFilesFragment.wxs"
  
  The output file generated by heat.exe and the given command and inputs. 

- t "..\RemoveDistFolderElementTransform.xslt" 

  The output of the **heat.exe** is processed through a custom **RemoveDistFolderElementTransform.xslt**
  before producing the output.

  In this specific case the command above does **not** use the **-srd** option which would cause **all**
  the directory references to be removed i.e. the components that are currently listed under the **Module**
  folder or any subfolder of **dist** would be flattened under the same Freagment element. As **dist** has
  the same directory structure as the installed product we want the directorie names to be harvested thus
  the **-srd** must not be used.

  However, this also causes heat to harvest of the **dist** directory itself which results in an extra
  **\<Directory Name="dist">** element nested just under **\<DirectoryRef Id="DIR_LOGXTREME_WIN_DSK">**.
  The tranformation **RemoveDistFolderElementTransform.xslt** removes this extra element.

---